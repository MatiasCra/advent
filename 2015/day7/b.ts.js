const input = await Deno.readTextFile('./input_b.txt');
const to16 = (src)=>src & 0b1111111111111111 // 16 bits
;
// func
const operate = (op, src1, src2)=>{
    if (op === 'AND') {
        return to16(src1 & src2);
    } else if (op === 'OR') {
        return to16(src1 | src2);
    } else if (op === 'NOT') {
        return to16(~src1);
    } else if (op === 'LSHIFT') {
        return to16(src1 << src2);
    } else if (op === 'RSHIFT') {
        return to16(src1 >> src2);
    } else if (op === 'COPY') {
        return to16(src1);
    }
    return 0;
};
const lines = input.split('\n');
lines.pop();
const values = new Map();
// Parse input
const circuit = lines.map((line)=>{
    const opI = line.search('AND|OR|NOT|LSHIFT|RSHIFT');
    const opIEnd = line.slice(opI, line.length).search(' ') + opI;
    let gate = line.slice(opI, opIEnd);
    if (gate === '') gate = 'COPY';
    const potentialSrc = line.slice(0, opI);
    if (potentialSrc !== '' && gate !== 'COPY') {
        let src1 = potentialSrc.slice(0, potentialSrc.length - 1);
        let src2 = line.slice(opIEnd + 1, line.slice(opIEnd + 1, line.length).search(' ') + opIEnd + 1);
        if (!isNaN(parseInt(src2))) src2 = parseInt(src2);
        if (!isNaN(parseInt(src1))) src1 = parseInt(src1);
        const dst = line.slice(line.search('->') + 3, line.length);
        return {
            gate,
            src1,
            src2,
            dst
        };
    } else {
        const prevEnd = gate !== 'COPY' ? opIEnd : -1;
        let src11 = line.slice(prevEnd + 1, line.slice(prevEnd + 1, line.length).search(' ') + prevEnd + 1);
        if (!isNaN(parseInt(src11))) src11 = parseInt(src11);
        const dst1 = line.slice(line.search('->') + 3, line.length);
        return {
            gate,
            src1: src11,
            dst: dst1
        };
    }
});
function resolveTag(tag) {
    /* Impure. Resolve recursively the values of the tags. Return the resolved tag value */ // Search the tags input
    const foundUnit = circuit.find((unit)=>unit.dst === tag);
    if (!foundUnit) {
        throw new Error(`Couldn't find tag ${tag}`) // This should never happen
        ;
    }
    if (typeof foundUnit.src1 === 'string') {
        if (values.has(foundUnit.src1)) foundUnit.src1 = values.get(foundUnit.src1);
        else foundUnit.src1 = resolveTag(foundUnit.src1);
    }
    if (typeof foundUnit.src2 === 'string') {
        if (values.has(foundUnit.src2)) foundUnit.src2 = values.get(foundUnit.src2);
        else foundUnit.src2 = resolveTag(foundUnit.src2);
    }
    const res = operate(foundUnit.gate, foundUnit.src1, foundUnit.src2);
    values.set(tag, res);
    console.log(`Tag ${tag} is ${res}`);
    return res;
}
console.log(resolveTag('a'));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImZpbGU6Ly8vaG9tZS9tYXRpYXNjcmEvRG9jdW1lbnRzL0Rlc2Fycm9sbG8vYWR2ZW50LzIwMTUvZGF5Ny9iLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IGlucHV0ID0gYXdhaXQgRGVuby5yZWFkVGV4dEZpbGUoJy4vaW5wdXRfYi50eHQnKVxuXG50eXBlIE9wZXJhdGlvbiA9ICdBTkQnIHwgJ09SJyB8ICdOT1QnIHwgJ0xTSElGVCcgfCAnUlNISUZUJyB8ICdDT1BZJ1xuXG5jb25zdCB0bzE2ID0gKHNyYzogbnVtYmVyKSA9PiBzcmMgJiAwYjExMTExMTExMTExMTExMTEgLy8gMTYgYml0c1xuXG4vLyBmdW5jXG5jb25zdCBvcGVyYXRlID0gKG9wOiBPcGVyYXRpb24sIHNyYzE6IG51bWJlciwgc3JjMjogbnVtYmVyKTogbnVtYmVyID0+IHtcbiAgaWYgKG9wID09PSAnQU5EJykge1xuICAgIHJldHVybiB0bzE2KHNyYzEgJiBzcmMyKVxuICB9IGVsc2UgaWYgKG9wID09PSAnT1InKSB7XG4gICAgcmV0dXJuIHRvMTYoc3JjMSB8IHNyYzIpXG4gIH0gZWxzZSBpZiAob3AgPT09ICdOT1QnKSB7XG4gICAgcmV0dXJuIHRvMTYofnNyYzEpXG4gIH0gZWxzZSBpZiAob3AgPT09ICdMU0hJRlQnKSB7XG4gICAgcmV0dXJuIHRvMTYoc3JjMSA8PCBzcmMyKVxuICB9IGVsc2UgaWYgKG9wID09PSAnUlNISUZUJykge1xuICAgIHJldHVybiB0bzE2KHNyYzEgPj4gc3JjMilcbiAgfSBlbHNlIGlmIChvcCA9PT0gJ0NPUFknKSB7XG4gICAgcmV0dXJuIHRvMTYoc3JjMSlcbiAgfVxuXG4gIHJldHVybiAwXG59XG5cbmNvbnN0IGxpbmVzID0gaW5wdXQuc3BsaXQoJ1xcbicpXG5saW5lcy5wb3AoKVxuXG5pbnRlcmZhY2UgQ2lyY3VpdFVuaXQge1xuICBnYXRlOiBPcGVyYXRpb25cbiAgc3JjMTogbnVtYmVyIHwgc3RyaW5nXG4gIHNyYzI/OiBudW1iZXIgfCBzdHJpbmdcbiAgZHN0OiBzdHJpbmdcbn1cblxuY29uc3QgdmFsdWVzID0gbmV3IE1hcDxzdHJpbmcsIG51bWJlcj4oKVxuXG4vLyBQYXJzZSBpbnB1dFxuY29uc3QgY2lyY3VpdCA9IGxpbmVzLm1hcCgobGluZSkgPT4ge1xuICBjb25zdCBvcEkgPSBsaW5lLnNlYXJjaCgnQU5EfE9SfE5PVHxMU0hJRlR8UlNISUZUJylcbiAgY29uc3Qgb3BJRW5kID0gbGluZS5zbGljZShvcEksIGxpbmUubGVuZ3RoKS5zZWFyY2goJyAnKSArIG9wSVxuICBsZXQgZ2F0ZSA9IGxpbmUuc2xpY2Uob3BJLCBvcElFbmQpIGFzIE9wZXJhdGlvbiB8ICcnXG4gIGlmIChnYXRlID09PSAnJykgZ2F0ZSA9ICdDT1BZJ1xuXG4gIGNvbnN0IHBvdGVudGlhbFNyYyA9IGxpbmUuc2xpY2UoMCwgb3BJKVxuXG4gIGlmIChwb3RlbnRpYWxTcmMgIT09ICcnICYmIGdhdGUgIT09ICdDT1BZJykge1xuICAgIGxldCBzcmMxOiBudW1iZXIgfCBzdHJpbmcgPSBwb3RlbnRpYWxTcmMuc2xpY2UoMCwgcG90ZW50aWFsU3JjLmxlbmd0aCAtIDEpXG4gICAgbGV0IHNyYzI6IG51bWJlciB8IHN0cmluZyA9IGxpbmUuc2xpY2UoXG4gICAgICBvcElFbmQgKyAxLFxuICAgICAgbGluZS5zbGljZShvcElFbmQgKyAxLCBsaW5lLmxlbmd0aCkuc2VhcmNoKCcgJykgKyBvcElFbmQgKyAxXG4gICAgKVxuXG4gICAgaWYgKCFpc05hTihwYXJzZUludChzcmMyKSkpIHNyYzIgPSBwYXJzZUludChzcmMyKVxuXG4gICAgaWYgKCFpc05hTihwYXJzZUludChzcmMxKSkpIHNyYzEgPSBwYXJzZUludChzcmMxKVxuXG4gICAgY29uc3QgZHN0ID0gbGluZS5zbGljZShsaW5lLnNlYXJjaCgnLT4nKSArIDMsIGxpbmUubGVuZ3RoKVxuXG4gICAgcmV0dXJuIHsgZ2F0ZSwgc3JjMSwgc3JjMiwgZHN0IH1cbiAgfSBlbHNlIHtcbiAgICBjb25zdCBwcmV2RW5kID0gZ2F0ZSAhPT0gJ0NPUFknID8gb3BJRW5kIDogLTFcblxuICAgIGxldCBzcmMxOiBudW1iZXIgfCBzdHJpbmcgPSBsaW5lLnNsaWNlKFxuICAgICAgcHJldkVuZCArIDEsXG4gICAgICBsaW5lLnNsaWNlKHByZXZFbmQgKyAxLCBsaW5lLmxlbmd0aCkuc2VhcmNoKCcgJykgKyBwcmV2RW5kICsgMVxuICAgIClcblxuICAgIGlmICghaXNOYU4ocGFyc2VJbnQoc3JjMSkpKSBzcmMxID0gcGFyc2VJbnQoc3JjMSlcblxuICAgIGNvbnN0IGRzdCA9IGxpbmUuc2xpY2UobGluZS5zZWFyY2goJy0+JykgKyAzLCBsaW5lLmxlbmd0aClcblxuICAgIHJldHVybiB7IGdhdGUsIHNyYzEsIGRzdCB9XG4gIH1cbn0pXG5cbmZ1bmN0aW9uIHJlc29sdmVUYWcodGFnOiBzdHJpbmcpOiBudW1iZXIge1xuICAvKiBJbXB1cmUuIFJlc29sdmUgcmVjdXJzaXZlbHkgdGhlIHZhbHVlcyBvZiB0aGUgdGFncy4gUmV0dXJuIHRoZSByZXNvbHZlZCB0YWcgdmFsdWUgKi9cbiAgLy8gU2VhcmNoIHRoZSB0YWdzIGlucHV0XG4gIGNvbnN0IGZvdW5kVW5pdCA9IGNpcmN1aXQuZmluZCgodW5pdCkgPT4gdW5pdC5kc3QgPT09IHRhZylcblxuICBpZiAoIWZvdW5kVW5pdCkge1xuICAgIHRocm93IG5ldyBFcnJvcihgQ291bGRuJ3QgZmluZCB0YWcgJHt0YWd9YCkgLy8gVGhpcyBzaG91bGQgbmV2ZXIgaGFwcGVuXG4gIH1cblxuICBpZiAodHlwZW9mIGZvdW5kVW5pdC5zcmMxID09PSAnc3RyaW5nJykge1xuICAgIGlmICh2YWx1ZXMuaGFzKGZvdW5kVW5pdC5zcmMxKSlcbiAgICAgIGZvdW5kVW5pdC5zcmMxID0gdmFsdWVzLmdldChmb3VuZFVuaXQuc3JjMSkgYXMgbnVtYmVyXG4gICAgZWxzZSBmb3VuZFVuaXQuc3JjMSA9IHJlc29sdmVUYWcoZm91bmRVbml0LnNyYzEpIGFzIG51bWJlclxuICB9XG5cbiAgaWYgKHR5cGVvZiBmb3VuZFVuaXQuc3JjMiA9PT0gJ3N0cmluZycpIHtcbiAgICBpZiAodmFsdWVzLmhhcyhmb3VuZFVuaXQuc3JjMikpXG4gICAgICBmb3VuZFVuaXQuc3JjMiA9IHZhbHVlcy5nZXQoZm91bmRVbml0LnNyYzIpIGFzIG51bWJlclxuICAgIGVsc2UgZm91bmRVbml0LnNyYzIgPSByZXNvbHZlVGFnKGZvdW5kVW5pdC5zcmMyKSBhcyBudW1iZXJcbiAgfVxuXG4gIGNvbnN0IHJlcyA9IG9wZXJhdGUoXG4gICAgZm91bmRVbml0LmdhdGUsXG4gICAgZm91bmRVbml0LnNyYzEgYXMgbnVtYmVyLFxuICAgIGZvdW5kVW5pdC5zcmMyIGFzIG51bWJlclxuICApXG5cbiAgdmFsdWVzLnNldCh0YWcsIHJlcylcblxuICBjb25zb2xlLmxvZyhgVGFnICR7dGFnfSBpcyAke3Jlc31gKVxuICByZXR1cm4gcmVzXG59XG5cbmNvbnNvbGUubG9nKHJlc29sdmVUYWcoJ2EnKSlcbiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxNQUFNLFFBQVEsTUFBTSxLQUFLLFlBQVksQ0FBQztBQUl0QyxNQUFNLE9BQU8sQ0FBQyxNQUFnQixNQUFNLG1CQUFtQixVQUFVOztBQUVqRSxPQUFPO0FBQ1AsTUFBTSxVQUFVLENBQUMsSUFBZSxNQUFjLE9BQXlCO0lBQ3JFLElBQUksT0FBTyxPQUFPO1FBQ2hCLE9BQU8sS0FBSyxPQUFPO0lBQ3JCLE9BQU8sSUFBSSxPQUFPLE1BQU07UUFDdEIsT0FBTyxLQUFLLE9BQU87SUFDckIsT0FBTyxJQUFJLE9BQU8sT0FBTztRQUN2QixPQUFPLEtBQUssQ0FBQztJQUNmLE9BQU8sSUFBSSxPQUFPLFVBQVU7UUFDMUIsT0FBTyxLQUFLLFFBQVE7SUFDdEIsT0FBTyxJQUFJLE9BQU8sVUFBVTtRQUMxQixPQUFPLEtBQUssUUFBUTtJQUN0QixPQUFPLElBQUksT0FBTyxRQUFRO1FBQ3hCLE9BQU8sS0FBSztJQUNkLENBQUM7SUFFRCxPQUFPO0FBQ1Q7QUFFQSxNQUFNLFFBQVEs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